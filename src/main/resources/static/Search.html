<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TuitionConnect - Book a Tutor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      background: linear-gradient(to right, #e3f2fd, #fce4ec);
      font-family: 'Segoe UI', sans-serif;
      transition: background 0.3s ease;
    }
    body.dark-mode {
      background: linear-gradient(to right, #1a1a1a, #2d1b21);
    }
    .stepper {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    .step {
      text-align: center;
      flex: 1;
      position: relative;
    }
    .step::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 2px;
      background: #dee2e6;
      z-index: -1;
    }
    .step:last-child::after {
      display: none;
    }
    .step-circle {
      width: 40px;
      height: 40px;
      background: #dee2e6;
      color: #6c757d;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.5rem;
      font-weight: bold;
    }
    .step.active .step-circle {
      background: #0d6efd;
      color: white;
    }
    .card {
      border: none;
      border-radius: 10px;
    }
    .tutor-card {
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .tutor-card:hover {
      transform: translateY(-5px);
    }
    .dark-mode .card {
      background-color: #2d2d2d;
    }
    .dark-mode .step::after {
      background: #495057;
    }
    .dark-mode .step-circle {
      background: #495057;
      color: #ced4da;
    }
    .dark-mode .step.active .step-circle {
      background: #0d6efd;
      color: white;
    }
    .dark-mode .tutor-card {
      background-color: #343a40;
      color: #e9ecef;
    }
    .confirmation-section {
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 1.5rem;
      height: 100%;
      transition: all 0.3s ease;
    }
    .dark-mode .confirmation-section {
      background: rgba(33, 37, 41, 0.5);
    }
    .confirmation-section:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .confirmation-details {
      padding-left: 3rem;
    }
    .tutor-rating {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .session-reminder {
      color: #6c757d;
      font-size: 0.9rem;
    }
    .confirmation-actions {
      border-top: 1px solid #dee2e6;
      padding-top: 1.5rem;
      margin-top: 2rem;
    }
    .dark-mode .confirmation-actions {
      border-color: #495057;
    }
    #special-requests {
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid #dee2e6;
      transition: all 0.3s ease;
    }
    .dark-mode #special-requests {
      background: rgba(33, 37, 41, 0.7);
      border-color: #495057;
      color: #fff;
    }
    #special-requests:focus {
      background: #fff;
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    .dark-mode #special-requests:focus {
      background: #2b3035;
    }
    .confirmation-header i {
      animation: checkmark 0.5s ease-in-out;
    }
    @keyframes checkmark {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }
    .form-check-input:checked {
      animation: checkbox 0.3s ease-in-out;
    }
    @keyframes checkbox {
      0% { transform: scale(1); }
      50% { transform: scale(0.9); }
      100% { transform: scale(1); }
    }
    footer {
      background-color: #343a40;
      color: white;
      padding: 15px 0;
      text-align: center;
      margin-top: 60px;
      font-size: 0.9rem;
    }
    .form-control, .form-select {
      padding: 0.75rem 1rem;
      border-radius: 8px;
    }
    
    .input-group-text {
      border-radius: 0 8px 8px 0;
      border-left: none;
    }
    
    .form-check-input:checked {
      background-color: #0d6efd;
      border-color: #0d6efd;
    }
    
    .form-check-label img {
      opacity: 0.7;
      transition: opacity 0.3s ease;
    }
    
    .form-check-input:checked + .form-check-label img {
      opacity: 1;
    }
    .time-slot-btn {
      min-width: 120px;
      transition: all 0.3s ease;
    }

    .time-slot-btn:hover {
      transform: translateY(-2px);
    }

    .time-slot-btn.btn-primary {
      box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
    }

    .input-group-text {
      background-color: transparent;
      border-left: none;
    }

    .form-control:focus + .input-group-text {
      border-color: #86b7fe;
    }

    .card.bg-light {
      background-color: rgba(248, 249, 250, 0.5) !important;
    }

    .dark-mode .card.bg-light {
      background-color: rgba(33, 37, 41, 0.5) !important;
    }

    .fade-out {
      opacity: 0;
      transition: opacity 0.3s ease-out;
    }
    
    .fade-in {
      opacity: 1;
      transition: opacity 0.3s ease-in;
    }
    
    .toast-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .toast-notification.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .toast-content {
      background: #fff;
      color: #333;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      font-size: 0.9rem;
    }
    
    .dark-mode .toast-content {
      background: #343a40;
      color: #fff;
    }
    
    /* Enhance payment method selection */
    .payment-method-label {
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #dee2e6;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .payment-method-label:hover {
      border-color: #0d6efd;
      transform: translateY(-2px);
    }
    
    input[name="payment-method"]:checked + .payment-method-label {
      border-color: #0d6efd;
      background-color: rgba(13, 110, 253, 0.1);
    }
    
    .dark-mode .payment-method-label {
      border-color: #495057;
    }
    
    .dark-mode .payment-method-label:hover {
      border-color: #0d6efd;
    }
    
    .dark-mode input[name="payment-method"]:checked + .payment-method-label {
      background-color: rgba(13, 110, 253, 0.2);
    }

    .payment-method-card {
      border: 2px solid #dee2e6;
      border-radius: 12px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
    }

    .payment-method-card:hover {
      border-color: #0d6efd;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .payment-method-card.selected {
      border-color: #0d6efd;
      background-color: rgba(13, 110, 253, 0.05);
    }

    .card-header {
      border: none;
      background: none;
      padding: 0 0 1rem 0;
    }

    .card-logos {
      display: flex;
      gap: 1rem;
      align-items: center;
      opacity: 0.7;
    }

    .payment-method-card.selected .card-logos {
      opacity: 1;
    }

    .dark-mode .payment-method-card {
      background: #2d2d2d;
      border-color: #495057;
    }

    .dark-mode .payment-method-card:hover {
      border-color: #0d6efd;
    }

    .dark-mode .payment-method-card.selected {
      background-color: rgba(13, 110, 253, 0.1);
    }

    .input-group-text {
      background: transparent;
    }

    .form-control:focus + .input-group-text {
      border-color: #86b7fe;
    }

    /* Add these transition styles */
    .step-content {
      transition: all 0.3s ease-in-out;
      opacity: 1;
      transform: translateX(0);
    }

    .step-content.sliding-out {
      opacity: 0;
      transform: translateX(-100%);
    }

    .step-content.sliding-in {
      opacity: 0;
      transform: translateX(100%);
    }

    .time-slot-btn {
      position: relative;
      overflow: hidden;
    }

    .time-slot-btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(13, 110, 253, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease-out, height 0.4s ease-out;
    }

    .time-slot-btn.selected::after {
      width: 200%;
      height: 200%;
    }

    .quick-select-container {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      padding: 1rem;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(100%);
      transition: transform 0.3s ease-out;
      z-index: 1000;
    }

    .quick-select-container.show {
      transform: translateY(0);
    }

    .dark-mode .quick-select-container {
      background: rgba(33, 37, 41, 0.95);
    }

    @keyframes slideRight {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    @keyframes slideLeft {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .sliding-right {
      animation: slideRight 0.3s ease-in-out forwards;
    }
    
    .sliding-left {
      animation: slideLeft 0.3s ease-in-out forwards;
    }
    
    .time-slot-btn.selected {
      position: relative;
      overflow: hidden;
    }
    
    .time-slot-btn.selected::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 1000%;
      height: 1000%;
      background: rgba(13, 110, 253, 0.1);
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(0);
      animation: ripple 0.6s ease-out;
    }
    
    @keyframes ripple {
      to {
        transform: translate(-50%, -50%) scale(1);
      }
    }

    /* Profile Dropdown Styles */
    .profile-dropdown {
      position: relative;
      display: inline-block;
    }

    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      object-fit: cover;
      border: 2px solid var(--bs-primary);
      transition: all 0.3s ease;
      background-color: #f8f9fa;
    }

    body.dark-mode .profile-pic {
      background-color: #2d3238;
    }

    .profile-pic:hover {
      border-color: #4cc9f0;
      transform: scale(1.05);
    }

    .profile-dropdown-menu {
      position: absolute;
      top: 120%;
      right: 0;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      min-width: 240px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 0, 0, 0.1);
      z-index: 1000;
      padding: 8px 0;
    }

    .profile-dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    body.dark-mode .profile-dropdown-menu {
      background: #2d2d2d;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .profile-header-item {
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .profile-header-item {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .profile-header-pic {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
    }

    .profile-header-info {
      flex: 1;
    }

    .profile-header-info .name {
      font-weight: 600;
      color: #000;
      margin-bottom: 2px;
    }

    .profile-header-info .email {
      font-size: 0.85rem;
      color: #6c757d;
    }

    body.dark-mode .profile-header-info .name {
      color: #fff;
    }

    body.dark-mode .profile-header-info .email {
      color: rgba(255, 255, 255, 0.7);
    }

    .dropdown-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #000;
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    body.dark-mode .dropdown-item {
      color: #fff;
    }

    .dropdown-item:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    body.dark-mode .dropdown-item:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .dropdown-divider {
      height: 1px;
      background: rgba(0, 0, 0, 0.1);
      margin: 8px 0;
    }

    body.dark-mode .dropdown-divider {
      background: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm py-3">
  <div class="container">
    <a class="navbar-brand" href="index.html">TuitionConnect</a>
    <div class="d-flex align-items-center" id="authButtons">
      <!-- Auth buttons will be dynamically populated -->
    </div>
  </div>
</nav>

<div class="container my-5">
  <h2 class="text-center mb-4"><i class="fas fa-search me-2"></i>Book Your Tutor</h2>

  <!-- Stepper -->
  <div class="stepper">
    <div class="step active" id="step-1">
      <div class="step-circle">1</div>
      <div>Select Subject</div>
    </div>
    <div class="step" id="step-2">
      <div class="step-circle">2</div>
      <div>Choose Tutor</div>
    </div>
    <div class="step" id="step-3">
      <div class="step-circle">3</div>
      <div>Pick Time</div>
    </div>
    <div class="step" id="step-4">
      <div class="step-circle">4</div>
      <div>Payment</div>
    </div>
    <div class="step" id="step-5">
      <div class="step-circle">5</div>
      <div>Confirm</div>
    </div>
  </div>

  <!-- Step 1: Select Subject -->
  <div class="card shadow step-content" id="content-1">
    <div class="card-body">
      <form id="subject-form">
        <div class="mb-3">
          <label for="subject" class="form-label">Select Subject</label>
          <select class="form-select" id="subject" required>
            <option value="">-- Select a subject --</option>
            <option value="OOP">Object-Oriented Programming (OOP)</option>
            <option value="DSA">Data Structures and Algorithms (DSA)</option>
            <option value="DM">Discrete Mathematics (DM)</option>
            <option value="TW">Technical Writing (TW)</option>
          </select>
          <small class="form-text text-muted">Choose the subject you need tutoring for.</small>
        </div>
        <div class="mb-3">
          <label for="education-level" class="form-label">Education Level</label>
          <select class="form-select" id="education-level" required>
            <option value="">-- Select education level --</option>
            <option value="school">School</option>
            <option value="college">College/University</option>
            <option value="professional">Professional Development</option>
          </select>
          <small class="form-text text-muted">Select your current education level.</small>
        </div>
        <button type="button" class="btn btn-primary w-100" onclick="nextStep(1)">Find Tutors</button>
      </form>
    </div>
  </div>

  <!-- Step 2: Choose Tutor -->
  <div class="card shadow step-content d-none" id="content-2">
    <div class="card-body">
      <h5>Available Tutors</h5>
      <div id="tutor-list" class="row">
        <!-- Tutors populated dynamically -->
      </div>
      <div class="d-flex justify-content-between mt-3">
        <button type="button" class="btn btn-outline-secondary" onclick="prevStep(2)">Back</button>
        <button type="button" class="btn btn-primary" onclick="nextStep(2)" id="next-step-2" disabled>Next</button>
      </div>
    </div>
  </div>

  <!-- Step 3: Pick Time -->
  <div class="card shadow step-content d-none" id="content-3">
    <div class="card-body">
      <h5 class="mb-4">Select Date & Time</h5>
      <form id="time-form">
        <!-- Date Selection -->
        <div class="mb-4">
          <label for="session-date" class="form-label">Select Date</label>
          <div class="input-group">
          <input type="date" class="form-control" id="session-date" required min="2025-05-16">
            <span class="input-group-text bg-white">
              <i class="fas fa-calendar text-primary"></i>
            </span>
        </div>
          <small class="form-text text-muted">Choose your preferred session date</small>
        </div>

        <!-- Time Slots -->
        <div class="mb-4">
          <label class="form-label">Available Time Slots</label>
          <div id="time-slots" class="d-flex flex-wrap gap-2">
            <!-- Time slots will be populated here -->
          </div>
          <small class="form-text text-muted mt-2">Selected time: <span id="selected-time" class="text-primary fw-bold">Not selected</span></small>
        </div>

        <!-- Duration Selection -->
        <div class="mb-4">
          <label for="duration" class="form-label">Session Duration</label>
          <div class="input-group">
          <select class="form-select" id="duration" required>
              <option value="">Select duration</option>
              <option value="1">1 hour ($<span class="duration-price">45</span>)</option>
              <option value="1.5">1.5 hours ($<span class="duration-price">67.50</span>)</option>
              <option value="2">2 hours ($<span class="duration-price">90</span>)</option>
          </select>
            <span class="input-group-text bg-white">
              <i class="fas fa-clock text-primary"></i>
            </span>
        </div>
          <small class="form-text text-muted">Choose how long you'd like your session to be</small>
        </div>

        <!-- Session Summary -->
        <div class="card bg-light border-0 p-4 mb-4">
          <h6 class="mb-3">Session Summary</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-user-circle fa-2x text-primary me-3"></i>
                <div>
                  <small class="text-muted">Tutor</small>
                  <p class="mb-0 fw-bold" id="summary-tutor-name">Not selected</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-book fa-2x text-success me-3"></i>
                <div>
                  <small class="text-muted">Subject</small>
                  <p class="mb-0 fw-bold" id="summary-subject-name">Not selected</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-calendar-alt fa-2x text-info me-3"></i>
                <div>
                  <small class="text-muted">Date</small>
                  <p class="mb-0 fw-bold" id="summary-date-selected">Not selected</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-center">
                <i class="fas fa-clock fa-2x text-warning me-3"></i>
                <div>
                  <small class="text-muted">Time & Duration</small>
                  <p class="mb-0 fw-bold" id="summary-time-duration">Not selected</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center">
          <button type="button" class="btn btn-outline-secondary" onclick="prevStep(3)">
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          <div>
            <span class="me-3">Total: <span class="h5 mb-0 text-primary" id="session-total">$0.00</span></span>
            <button type="button" class="btn btn-primary" onclick="proceedToPayment()" id="proceed-payment-btn" disabled>
              Proceed to Payment<i class="fas fa-arrow-right ms-2"></i>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Step 4: Payment -->
  <div class="card shadow step-content d-none" id="content-4">
    <div class="card-body">
      <h5 class="mb-4">Payment Method</h5>
      <form id="payment-form">
        <!-- Payment Method Cards -->
        <div class="payment-cards mb-4">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="payment-method-card" onclick="selectPaymentMethod('card')">
                <div class="card-header">
                  <h6 class="mb-0">Credit/Debit Card</h6>
            </div>
                <div class="card-logos">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/100px-Mastercard-logo.svg.png" alt="Mastercard" height="25">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/100px-Visa_Inc._logo.svg.png" alt="Visa" height="25">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/American_Express_logo_%282018%29.svg/100px-American_Express_logo_%282018%29.svg.png" alt="American Express" height="25">
            </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="payment-method-card" onclick="selectPaymentMethod('paypal')">
                <div class="card-header">
                  <h6 class="mb-0">PayPal</h6>
                </div>
                <div class="card-logos">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/PayPal.svg/100px-PayPal.svg.png" alt="PayPal" height="25">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Details Form -->
        <div id="card-details-form" class="mb-4">
          <div class="card bg-light border-0">
            <div class="card-body">
          <div class="mb-3">
                <label class="form-label">Card Number</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="card-number" placeholder="XXXX XXXX XXXX XXXX" maxlength="19">
                  <span class="input-group-text">
                    <i class="fas fa-credit-card"></i>
                  </span>
          </div>
            </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Expiry Date</label>
                  <div class="input-group">
                    <select class="form-select" id="expiry-month">
                      <option value="">MM</option>
                      <option value="01">1</option>
                      <option value="02">2</option>
                      <option value="03">3</option>
                      <option value="04">4</option>
                      <option value="05">5</option>
                      <option value="06">6</option>
                      <option value="07">7</option>
                      <option value="08">8</option>
                      <option value="09">9</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                    </select>
                    <select class="form-select" id="expiry-year">
                      <option value="">YY</option>
                      <option value="25">2025</option>
                      <option value="26">2026</option>
                      <option value="27">2027</option>
                      <option value="28">2028</option>
                      <option value="29">2029</option>
                      <option value="30">2030</option>
                      <option value="31">2031</option>
                      <option value="32">2032</option>
                      <option value="33">2033</option>
                      <option value="34">2034</option>
                      <option value="35">2035</option>
                    </select>
            </div>
          </div>
                <div class="col-md-6">
                  <label class="form-label">Security Code</label>
                  <div class="input-group">
                    <input type="password" class="form-control" id="security-code" placeholder="***" maxlength="4">
                    <span class="input-group-text">
                      <i class="fas fa-lock"></i>
                    </span>
          </div>
        </div>
              </div>
            </div>
          </div>
        </div>

        <!-- PayPal Section -->
        <div id="paypal-section" class="d-none mb-4">
          <div class="alert alert-info">
            <i class="fab fa-paypal me-2"></i>
            You will be redirected to PayPal to complete your payment securely.
          </div>
        </div>

        <!-- Order Summary -->
        <div class="card bg-light border-0 mb-4">
          <div class="card-body">
            <h6 class="mb-3">Order Summary</h6>
            <div class="d-flex justify-content-between mb-2">
              <span>Session Fee</span>
              <span id="summary-fee">$0.00</span>
        </div>
            <div class="d-flex justify-content-between mb-2">
              <span>Service Fee</span>
              <span id="summary-service-fee">$5.00</span>
            </div>
            <hr>
        <div class="d-flex justify-content-between">
              <strong>Total Amount</strong>
              <strong id="summary-total" class="text-primary">$0.00</strong>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center">
          <button type="button" class="btn btn-outline-secondary" onclick="prevStep(4)">
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          <button type="button" class="btn btn-primary" onclick="processPayment()" id="process-payment-btn">
            Pay Now<i class="fas fa-lock ms-2"></i>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Step 5: Confirm -->
  <div class="card shadow step-content d-none" id="content-5">
    <div class="card-body">
      <div class="confirmation-header text-center mb-4">
        <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
        <h4 class="mb-2">Almost Done!</h4>
        <p class="text-muted">Please review your booking details below</p>
      </div>

      <div class="row g-4">
        <!-- Tutor Details -->
        <div class="col-md-6">
          <div class="confirmation-section">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-user-circle fa-2x text-primary me-3"></i>
              <h5 class="mb-0">Tutor Details</h5>
      </div>
            <div class="confirmation-details">
              <p class="mb-2"><strong>Name:</strong> <span id="confirm-tutor">Not selected</span></p>
              <p class="mb-2"><strong>Rate:</strong> <span id="confirm-rate">$0/hour</span></p>
              <p class="mb-2"><strong>Subject:</strong> <span id="confirm-subject">Not selected</span></p>
              <div class="tutor-rating mt-2">
                <div class="stars">
                  <i class="fas fa-star text-warning"></i>
                  <i class="fas fa-star text-warning"></i>
                  <i class="fas fa-star text-warning"></i>
                  <i class="fas fa-star text-warning"></i>
                  <i class="fas fa-star-half-alt text-warning"></i>
      </div>
                <small class="text-muted">4.8 (120+ reviews)</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Session Details -->
        <div class="col-md-6">
          <div class="confirmation-section">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-calendar-check fa-2x text-success me-3"></i>
              <h5 class="mb-0">Session Details</h5>
            </div>
            <div class="confirmation-details">
              <p class="mb-2"><strong>Date:</strong> <span id="confirm-date">Not selected</span></p>
              <p class="mb-2"><strong>Time:</strong> <span id="confirm-time">Not selected</span></p>
              <p class="mb-2"><strong>Duration:</strong> <span id="confirm-duration">Not selected</span></p>
              <div class="session-reminder mt-2">
                <i class="fas fa-bell text-warning me-2"></i>
                <small>You'll receive a reminder 24 hours before your session</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Details -->
        <div class="col-md-6">
          <div class="confirmation-section">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-credit-card fa-2x text-info me-3"></i>
              <h5 class="mb-0">Payment Details</h5>
            </div>
            <div class="confirmation-details">
              <p class="mb-2"><strong>Method:</strong> <span id="confirm-payment">Not selected</span></p>
              <p class="mb-2"><strong>Subtotal:</strong> <span id="confirm-subtotal">$0.00</span></p>
              <p class="mb-2"><strong>Service Fee:</strong> <span id="confirm-service-fee">$5.00</span></p>
              <p class="mb-0"><strong>Total:</strong> <span id="confirm-total" class="text-primary fw-bold">$0.00</span></p>
            </div>
          </div>
        </div>

        <!-- Additional Options -->
        <div class="col-md-6">
          <div class="confirmation-section">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-cog fa-2x text-secondary me-3"></i>
              <h5 class="mb-0">Additional Options</h5>
            </div>
            <div class="confirmation-details">
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="reminder-email" checked>
                <label class="form-check-label" for="reminder-email">
                  Email reminders
                </label>
              </div>
              <div class="form-check mb-2">
                <input class="form-check-input" type="checkbox" id="calendar-invite" checked>
                <label class="form-check-label" for="calendar-invite">
                  Add to calendar
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="share-materials" checked>
                <label class="form-check-label" for="share-materials">
                  Share learning materials
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Special Requests -->
        <div class="col-12">
          <div class="confirmation-section">
            <div class="d-flex align-items-center mb-3">
              <i class="fas fa-comment-alt fa-2x text-warning me-3"></i>
              <h5 class="mb-0">Special Requests</h5>
            </div>
            <textarea class="form-control" id="special-requests" rows="3" 
              placeholder="Add any special instructions or requests for your tutor (optional)"></textarea>
          </div>
        </div>
      </div>

      <div class="confirmation-actions mt-4">
        <div class="d-flex justify-content-between align-items-center">
          <button type="button" class="btn btn-outline-secondary" onclick="prevStep(5)">
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          <button type="button" class="btn btn-primary btn-lg" onclick="confirmBooking()">
            Confirm Booking<i class="fas fa-check ms-2"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Step 6: Confirmation -->
  <div class="card shadow step-content d-none" id="content-6">
    <div class="card-body text-center">
      <h5 class="text-success"><i class="fas fa-check-circle me-2"></i>Booking Confirmed!</h5>
      <p>Your tutoring session has been successfully booked. You'll receive a confirmation email with all the details shortly.</p>
      <a href="viewbooking.html" class="btn btn-primary">View My Bookings</a>
    </div>
  </div>
</div>

<footer>
  © 2025 TuitionConnect. All rights reserved.
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let currentStep = 1;
  const bookingData = {
    subject: '',
    educationLevel: '',
    tutor: '',
    date: '',
    time: '',
    duration: '',
    paymentMethod: '',
    specialRequests: ''
  };

  // Add state management object
  const stateManager = {
    steps: {},
    saveState: function(step) {
      this.steps[step] = {
        subject: document.getElementById('subject').value,
        educationLevel: document.getElementById('education-level').value,
        tutor: bookingData.tutor,
        date: document.getElementById('session-date').value,
        time: bookingData.time,
        duration: document.getElementById('duration').value,
        paymentMethod: bookingData.paymentMethod,
        cardNumber: document.getElementById('card-number').value,
        expiryMonth: document.getElementById('expiry-month').value,
        expiryYear: document.getElementById('expiry-year').value
      };
    },
    restoreState: function(step) {
      const state = this.steps[step];
      if (!state) return;

      if (state.subject) document.getElementById('subject').value = state.subject;
      if (state.educationLevel) document.getElementById('education-level').value = state.educationLevel;
      if (state.date) document.getElementById('session-date').value = state.date;
      if (state.duration) document.getElementById('duration').value = state.duration;
      if (state.cardNumber) document.getElementById('card-number').value = state.cardNumber;
      if (state.expiryMonth) document.getElementById('expiry-month').value = state.expiryMonth;
      if (state.expiryYear) document.getElementById('expiry-year').value = state.expiryYear;
      
      // Restore tutor selection
      if (state.tutor) {
        bookingData.tutor = state.tutor;
        const tutorCards = document.querySelectorAll('.tutor-card');
        tutorCards.forEach(card => {
          if (card.querySelector('h5').textContent === state.tutor) {
            card.classList.add('border', 'border-primary', 'border-2');
          }
        });
      }

      // Restore time selection
      if (state.time) {
        bookingData.time = state.time;
        const timeSlots = document.querySelectorAll('.time-slot-btn');
        timeSlots.forEach(btn => {
          if (btn.textContent.includes(state.time)) {
            btn.classList.add('selected', 'btn-primary');
            btn.classList.remove('btn-outline-primary');
          }
        });
      }

      // Restore payment method
      if (state.paymentMethod) {
        bookingData.paymentMethod = state.paymentMethod;
        selectPaymentMethod(state.paymentMethod);
      }
    }
  };

  // Dark Mode Toggle
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const navbar = document.querySelector('.navbar');
    if (document.body.classList.contains('dark-mode')) {
      document.body.style.background = 'linear-gradient(to right, #1a1a1a, #2d1b21)';
      navbar.classList.remove('navbar-light', 'bg-light');
      navbar.classList.add('navbar-dark', 'bg-dark');
      document.querySelector('.dark-toggle').innerHTML = '<i class="fas fa-sun"></i>';
    } else {
      document.body.style.background = 'linear-gradient(to right, #e3f2fd, #fce4ec)';
      navbar.classList.remove('navbar-dark', 'bg-dark');
      navbar.classList.add('navbar-light', 'bg-light');
      document.querySelector('.dark-toggle').innerHTML = '<i class="fas fa-moon"></i>';
    }
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
  }

  if (localStorage.getItem('darkMode') === 'true') {
    toggleDarkMode();
  }

  // Remove the old subjects fetch
  window.onload = function() {
    // Set minimum date for session booking to today
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('session-date').min = tomorrow.toISOString().split('T')[0];
  };

  // Fetch Tutors Based on Subject
  function fetchTutors() {
    const subject = document.getElementById('subject').value;
    const educationLevel = document.getElementById('education-level').value;
    bookingData.subject = document.getElementById('subject').options[document.getElementById('subject').selectedIndex].text;
    bookingData.educationLevel = educationLevel;

    // Updated tutor data with our specific tutors
    const tutors = {
      'OOP': [
        { 
          name: 'Mr. Pubudu Senanayake', 
          specialization: 'Object-Oriented Programming Expert', 
          experience: 5, 
          rating: 4.9, 
          reviews: 120, 
          description: 'Experienced in teaching Java, Python, and C++ with practical examples and real-world applications.',
          rate: 45,
          availability: '90%',
          languages: 'Java, Python, C++',
          expertise: ['OOP Concepts', 'Design Patterns', 'Clean Code']
        }
      ],
      'DSA': [
        { 
          name: 'Ms. Gayani Koswatte', 
          specialization: 'Data Structures and Algorithms Expert', 
          experience: 4, 
          rating: 4.8, 
          reviews: 95, 
          description: 'Specialized in teaching complex algorithms and data structures with a focus on problem-solving techniques.',
          rate: 40,
          availability: '85%',
          languages: 'Java, C++',
          expertise: ['Algorithm Analysis', 'Data Structures', 'Problem Solving']
        }
      ],
      'DM': [
        { 
          name: 'Ms. Malki Weerasinghe', 
          specialization: 'Discrete Mathematics Expert', 
          experience: 6, 
          rating: 4.9, 
          reviews: 150, 
          description: 'Expert in teaching discrete mathematics concepts with practical applications in computer science.',
          rate: 50,
          availability: '95%',
          languages: 'English, Sinhala',
          expertise: ['Graph Theory', 'Logic', 'Number Theory']
        }
      ],
      'TW': [
        { 
          name: 'Ms. Chathuni Rajapaksha', 
          specialization: 'Technical Writing Expert', 
          experience: 3, 
          rating: 4.7, 
          reviews: 80, 
          description: 'Specialized in teaching technical documentation and professional writing skills.',
          rate: 35,
          availability: '88%',
          languages: 'English, Sinhala',
          expertise: ['Documentation', 'Report Writing', 'Technical Communication']
        }
      ]
    };

        const tutorList = document.getElementById('tutor-list');
        tutorList.innerHTML = '';
    
    const subjectTutors = tutors[subject] || [];
    subjectTutors.forEach(tutor => {
          const tutorCard = document.createElement('div');
      tutorCard.className = 'col-md-6 mb-4';
          tutorCard.innerHTML = `
        <div class="card tutor-card shadow p-3">
          <div class="d-flex align-items-center mb-3">
            <i class="fas fa-user-circle fa-3x me-3 text-primary"></i>
            <div>
              <h5 class="mb-1">${tutor.name}</h5>
              <span class="badge bg-primary">${tutor.specialization}</span>
            </div>
          </div>
          <div class="mb-3">
            <p class="mb-2"><i class="fas fa-star text-warning me-2"></i>${tutor.rating} (${tutor.reviews} reviews)</p>
            <p class="mb-2"><i class="fas fa-clock me-2"></i>${tutor.experience} years experience</p>
            <p class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>${tutor.availability} availability</p>
            <p class="mb-2"><i class="fas fa-code me-2"></i>${tutor.languages}</p>
          </div>
          <div class="mb-3">
            <h6 class="mb-2">Areas of Expertise:</h6>
            <div class="d-flex flex-wrap gap-2">
              ${tutor.expertise.map(exp => `<span class="badge bg-light text-dark">${exp}</span>`).join('')}
            </div>
          </div>
          <p class="small mb-3">${tutor.description}</p>
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">$${tutor.rate}/hour</h6>
            <button type="button" class="btn btn-primary" onclick="selectTutor('${tutor.name}', ${tutor.rate})">
              Select Tutor
            </button>
          </div>
            </div>
          `;
          tutorList.appendChild(tutorCard);
        });

    // Add no tutors found message if array is empty
    if (subjectTutors.length === 0) {
      tutorList.innerHTML = `
        <div class="col-12 text-center py-4">
          <i class="fas fa-search fa-3x text-muted mb-3"></i>
          <h5>No tutors found for ${subject}</h5>
          <p class="text-muted">Please try selecting a different subject or check back later.</p>
        </div>
      `;
    }
  }

  function selectTutor(name, rate) {
    bookingData.tutor = name;
    bookingData.rate = rate;
    
    // Enable the next button
    document.getElementById('next-step-2').disabled = false;
    
    // Update visual selection
    document.querySelectorAll('.tutor-card').forEach(card => {
      if (card.querySelector('h5').textContent === name) {
        card.classList.add('border', 'border-primary', 'border-2');
      } else {
        card.classList.remove('border', 'border-primary', 'border-2');
      }
    });

    // Show selection confirmation
    const selectedTutor = document.querySelector('.tutor-card.border-primary');
    if (selectedTutor) {
      selectedTutor.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }

  // Populate Time Slots
  function updateTimeSlots() {
    const timeSlots = [
      '9:00 AM', '10:30 AM', '12:00 PM', '2:00 PM', 
      '3:30 PM', '5:00 PM', '6:30 PM', '8:00 PM'
    ];
    
  const timeSlotsContainer = document.getElementById('time-slots');
    timeSlotsContainer.innerHTML = '';
    
  timeSlots.forEach(slot => {
    const button = document.createElement('button');
    button.type = 'button';
      button.className = 'btn btn-outline-primary time-slot-btn mb-2 me-2';
      button.innerHTML = `
        <i class="far fa-clock me-2"></i>${slot}
        <span class="duration-badge ms-2 d-none">
          <i class="fas fa-check"></i>
        </span>
      `;
      button.onclick = () => selectTimeSlot(slot);
    timeSlotsContainer.appendChild(button);
  });

    // Add styles for time slots
    const style = document.createElement('style');
    style.textContent = `
      .time-slot-btn {
        min-width: 140px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }
      
      .time-slot-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }
      
      .time-slot-btn.selected {
        background: #0d6efd;
        color: white;
        border-color: #0d6efd;
      }
      
      .time-slot-btn.selected:hover {
        background: #0b5ed7;
      }
      
      .duration-badge {
        position: absolute;
        right: -20px;
        top: 50%;
        transform: translateY(-50%);
        transition: all 0.3s ease;
        opacity: 0;
      }
      
      .time-slot-btn.selected .duration-badge {
        right: 10px;
        opacity: 1;
      }
      
      .time-slots-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }
      
      @keyframes selectPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
    `;
    document.head.appendChild(style);
  }

  function selectTimeSlot(slot) {
    const allSlots = document.querySelectorAll('.time-slot-btn');
    allSlots.forEach(btn => {
      btn.classList.remove('selected');
    });
    
    const selectedBtn = Array.from(allSlots).find(btn => btn.textContent.includes(slot));
    if (selectedBtn) {
      selectedBtn.classList.add('selected');
      selectedBtn.style.animation = 'selectPulse 0.3s ease';
      setTimeout(() => selectedBtn.style.animation = '', 300);
    }
    
    document.getElementById('selected-time').textContent = slot;
    bookingData.time = slot;
    
    // Show duration selector immediately
    showDurationSelector(slot);
  }

  function showDurationSelector(selectedTime) {
    // Create duration selector
    const durationSelector = document.createElement('div');
    durationSelector.className = 'duration-selector';
    durationSelector.innerHTML = `
      <div class="duration-overlay"></div>
      <div class="duration-content">
        <h5 class="mb-3">Select Session Duration</h5>
        <div class="duration-options">
          <button onclick="selectDurationAndProceed(1)" class="btn btn-lg btn-outline-primary w-100 mb-2">
            1 Hour
            <div class="small text-muted">$${bookingData.rate}</div>
          </button>
          <button onclick="selectDurationAndProceed(1.5)" class="btn btn-lg btn-outline-primary w-100 mb-2">
            1.5 Hours
            <div class="small text-muted">$${bookingData.rate * 1.5}</div>
          </button>
          <button onclick="selectDurationAndProceed(2)" class="btn btn-lg btn-outline-primary w-100">
            2 Hours
            <div class="small text-muted">$${bookingData.rate * 2}</div>
          </button>
        </div>
      </div>
    `;
    
    // Add styles for duration selector
    const style = document.createElement('style');
    style.textContent = `
      .duration-selector {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1050;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .duration-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        animation: fadeIn 0.3s ease;
      }
      
      .duration-content {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        position: relative;
        z-index: 1;
        min-width: 300px;
        animation: slideUp 0.3s ease;
      }
      
      .dark-mode .duration-content {
        background: #343a40;
        color: white;
      }
      
      .duration-options button {
        position: relative;
        transition: all 0.3s ease;
      }
      
      .duration-options button:hover {
        transform: translateY(-2px);
      }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      
      @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
    
    // Add to document
    document.body.appendChild(durationSelector);
    
    // Close on overlay click
    durationSelector.querySelector('.duration-overlay').onclick = () => {
      durationSelector.remove();
    };
    
    // Close on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        durationSelector.remove();
      }
    }, { once: true });
  }

  function selectDurationAndProceed(duration) {
    // Update duration
    document.getElementById('duration').value = duration;
    bookingData.duration = duration;
    
    // Remove duration selector
    const selector = document.querySelector('.duration-selector');
    if (selector) {
      selector.remove();
    }
    
    // Update summary and proceed to payment
    updateSessionSummary();
    proceedToPayment();
  }

  // Update the proceed to payment function for smoother transition
  function proceedToPayment() {
    const date = document.getElementById('session-date').value;
    const duration = document.getElementById('duration').value;
    const selectedTime = bookingData.time;

    if (!date || !selectedTime || !duration) {
      showToast('Please select date, time, and duration');
      return;
    }

    // Update booking data
    bookingData.date = date;
    bookingData.duration = duration;
    const baseTotal = bookingData.rate * parseFloat(duration);
    const serviceFee = 5.00;
    bookingData.total = baseTotal + serviceFee;

    // Quick transition to payment
    const currentContent = document.getElementById('content-3');
    const paymentContent = document.getElementById('content-4');

    currentContent.style.opacity = '0';
    currentContent.style.transition = 'opacity 0.2s ease';

    setTimeout(() => {
      currentContent.classList.add('d-none');
      document.getElementById('step-3').classList.remove('active');
      
      paymentContent.classList.remove('d-none');
      document.getElementById('step-4').classList.add('active');
      paymentContent.style.opacity = '1';
      
      // Update current step and select payment method
      currentStep = 4;
      selectPaymentMethod('card');

      // Update payment summary
      document.getElementById('summary-fee').textContent = `$${baseTotal.toFixed(2)}`;
      document.getElementById('summary-service-fee').textContent = `$${serviceFee.toFixed(2)}`;
      document.getElementById('summary-total').textContent = `$${bookingData.total.toFixed(2)}`;

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 200);
  }

  // Payment Method Toggle
  document.querySelectorAll('input[name="payment-method"]').forEach(input => {
    input.addEventListener('change', () => {
      if (input.value === 'paypal') {
        document.getElementById('card-details-form').classList.add('d-none');
        document.getElementById('paypal-section').classList.remove('d-none');
      } else {
        document.getElementById('card-details-form').classList.remove('d-none');
        document.getElementById('paypal-section').classList.add('d-none');
      }
    });
  });

  // Card number formatting
  document.getElementById('card-number').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    value = value.replace(/(.{4})/g, '$1 ').trim();
    e.target.value = value;
  });

  // Security code handling
  document.getElementById('security-code').addEventListener('input', function(e) {
    e.target.value = e.target.value.replace(/\D/g, '');
  });

  // Step Navigation
  function nextStep(step) {
    // Save current state
    stateManager.saveState(step);

    if (step === 1) {
      if (!document.getElementById('subject-form').checkValidity()) {
        document.getElementById('subject-form').reportValidity();
        return;
      }
      fetchTutors();
    }

    if (step === 2 && !bookingData.tutor) {
      showToast('Please select a tutor to continue');
      return;
    }

    if (step === 3) {
      if (!bookingData.time || !document.getElementById('session-date').value || !document.getElementById('duration').value) {
        showToast('Please select date, time, and duration');
        return;
      }
      updateSessionSummary();
    }

    if (step === 4) {
      if (!validatePaymentDetails()) {
        return;
      }
      updateConfirmation();
    }

    // Animate transition
    const currentContent = document.getElementById(`content-${step}`);
    const nextContent = document.getElementById(`content-${step + 1}`);

    currentContent.style.opacity = '0';
    currentContent.style.transition = 'opacity 0.3s ease';

    setTimeout(() => {
      currentContent.classList.add('d-none');
    document.getElementById(`step-${step}`).classList.remove('active');
      
      nextContent.classList.remove('d-none');
      nextContent.style.opacity = '1';
      document.getElementById(`step-${step + 1}`).classList.add('active');
      
    currentStep = step + 1;
      
      // Restore state if exists
      stateManager.restoreState(currentStep);
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 300);
  }

  function prevStep(step) {
    // Save current state
    stateManager.saveState(step);

    const currentContent = document.getElementById(`content-${step}`);
    const prevContent = document.getElementById(`content-${step - 1}`);
    
    // Animate transition
    currentContent.style.opacity = '0';
    currentContent.style.transition = 'opacity 0.3s ease';
    
    setTimeout(() => {
      currentContent.classList.add('d-none');
    document.getElementById(`step-${step}`).classList.remove('active');
      
      prevContent.classList.remove('d-none');
      prevContent.style.opacity = '1';
      document.getElementById(`step-${step - 1}`).classList.add('active');
      
    currentStep = step - 1;
      
      // Restore previous state
      stateManager.restoreState(currentStep);
      
      // Update summary if going back to time selection
      if (step === 4) {
        updateSessionSummary();
      }
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 300);
  }

  function validatePaymentDetails() {
    if (bookingData.paymentMethod === 'card') {
      const cardNumber = document.getElementById('card-number').value.replace(/\s/g, '');
      const expiryMonth = document.getElementById('expiry-month').value;
      const expiryYear = document.getElementById('expiry-year').value;
      const securityCode = document.getElementById('security-code').value;

      if (!cardNumber || cardNumber.length !== 16) {
        showToast('Please enter a valid card number');
        return false;
      }
      if (!expiryMonth || !expiryYear) {
        showToast('Please select card expiry date');
        return false;
      }
      if (!securityCode || securityCode.length < 3) {
        showToast('Please enter a valid security code');
        return false;
      }
    }
    return true;
  }

  // Update showToast function to be more visible
  function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.innerHTML = `
      <div class="toast-content">
        <i class="fas fa-info-circle me-2"></i>
        ${message}
      </div>
    `;
    document.body.appendChild(toast);
    
    requestAnimationFrame(() => {
      toast.classList.add('show');
    });
    
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  function updateSessionSummary() {
    const date = document.getElementById('session-date').value;
    const time = bookingData.time;
    const duration = document.getElementById('duration').value;
    
    if (date || time || duration) {
      const formattedDate = date ? new Date(date).toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      }) : 'Not selected';

      // Update summary in time selection step
      document.getElementById('summary-tutor-name').textContent = bookingData.tutor || 'Not selected';
      document.getElementById('summary-subject-name').textContent = bookingData.subject || 'Not selected';
      document.getElementById('summary-date-selected').textContent = formattedDate;
      document.getElementById('summary-time-duration').textContent = 
        time ? `${time}${duration ? ` (${duration} hour${duration > 1 ? 's' : ''})` : ''}` : 'Not selected';
      
      // Calculate costs if we have duration
      if (duration) {
        const baseAmount = bookingData.rate * parseFloat(duration);
        const serviceFee = 5.00;
        const total = baseAmount + serviceFee;
        
        // Update session total
        document.getElementById('session-total').textContent = `$${total.toFixed(2)}`;
      }
    }
  }

  function updateConfirmation() {
    // Format date nicely
    const formattedDate = new Date(bookingData.date).toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

    // Calculate end time
    const endTime = calculateEndTime(bookingData.time, bookingData.duration);

    // Calculate costs
    const subtotal = bookingData.rate * parseFloat(bookingData.duration);
    const serviceFee = 5.00;
    const total = subtotal + serviceFee;

    // Update all confirmation fields
    document.getElementById('confirm-tutor').textContent = bookingData.tutor;
    document.getElementById('confirm-rate').textContent = `$${bookingData.rate}/hour`;
    document.getElementById('confirm-subject').textContent = bookingData.subject;
    document.getElementById('confirm-date').textContent = formattedDate;
    document.getElementById('confirm-time').textContent = `${bookingData.time} - ${endTime}`;
    document.getElementById('confirm-duration').textContent = `${bookingData.duration} hour${bookingData.duration > 1 ? 's' : ''}`;
    document.getElementById('confirm-payment').textContent = bookingData.paymentMethod === 'card' ? 'Credit/Debit Card' : 'PayPal';
    document.getElementById('confirm-subtotal').textContent = `$${subtotal.toFixed(2)}`;
    document.getElementById('confirm-service-fee').textContent = `$${serviceFee.toFixed(2)}`;
    document.getElementById('confirm-total').textContent = `$${total.toFixed(2)}`;

    // Add animation to the confirmation header
    const checkIcon = document.querySelector('.confirmation-header i');
    checkIcon.style.animation = 'none';
    checkIcon.offsetHeight; // Trigger reflow
    checkIcon.style.animation = 'checkmark 0.5s ease-in-out';
  }

  function calculateEndTime(startTime, duration) {
    const [time, period] = startTime.split(' ');
    let [hours, minutes] = time.split(':').map(Number);
    hours = period === 'PM' && hours !== 12 ? hours + 12 : hours;
    hours = period === 'AM' && hours === 12 ? 0 : hours;
    const totalMinutes = (hours * 60 + minutes) + (parseFloat(duration) * 60);
    const endHours = Math.floor(totalMinutes / 60) % 24;
    const endMinutes = totalMinutes % 60;
    const endPeriod = endHours >= 12 ? 'PM' : 'AM';
    const displayHours = endHours % 12 === 0 ? 12 : endHours % 12;
    return `${displayHours}:${endMinutes.toString().padStart(2, '0')} ${endPeriod}`;
  }

  function confirmBooking() {
    const confirmBtn = document.querySelector('.confirmation-actions .btn-primary');
    const originalText = confirmBtn.innerHTML;
    
    // Show loading state
    confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
    confirmBtn.disabled = true;

    // Gather additional options
    const additionalOptions = {
      emailReminders: document.getElementById('reminder-email').checked,
      calendarInvite: document.getElementById('calendar-invite').checked,
      shareMaterials: document.getElementById('share-materials').checked,
      specialRequests: document.getElementById('special-requests').value.trim()
    };

    // Combine booking data
    const finalBookingData = {
      ...bookingData,
      ...additionalOptions
    };

    // Simulate API call
    setTimeout(() => {
      // Show success animation
      const successAnimation = document.createElement('div');
      successAnimation.className = 'booking-success-animation';
      successAnimation.innerHTML = `
        <div class="success-content">
          <i class="fas fa-check-circle text-success fa-4x mb-3"></i>
          <h4>Booking Confirmed!</h4>
          <p>Your session has been successfully booked.</p>
          <div class="mt-3">
            <a href="viewbooking.html" class="btn btn-primary">View My Bookings</a>
          </div>
        </div>
      `;

      // Add success animation styles
      const style = document.createElement('style');
      style.textContent = `
        .booking-success-animation {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1050;
          animation: fadeIn 0.3s ease;
        }

        .success-content {
          background: white;
          padding: 2rem;
          border-radius: 12px;
          text-align: center;
          animation: slideUp 0.3s ease;
        }

        .dark-mode .success-content {
          background: #343a40;
          color: white;
        }

        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        @keyframes slideUp {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      document.body.appendChild(successAnimation);

      // Remove success animation after 3 seconds and redirect
      setTimeout(() => {
        successAnimation.style.opacity = '0';
        successAnimation.style.transition = 'opacity 0.3s ease';
        setTimeout(() => {
          successAnimation.remove();
          window.location.href = 'viewbooking.html';
        }, 300);
      }, 3000);

    }, 2000);
  }

  function selectPaymentMethod(method) {
    // Remove selection from all cards
    document.querySelectorAll('.payment-method-card').forEach(card => {
      card.classList.remove('selected');
    });
    
    // Add selection to clicked card
    const selectedCard = document.querySelector(`.payment-method-card[onclick*="${method}"]`);
    if (selectedCard) {
      selectedCard.classList.add('selected');
    }
    
    // Show/hide relevant sections
    if (method === 'card') {
      document.getElementById('card-details-form').classList.remove('d-none');
      document.getElementById('paypal-section').classList.add('d-none');
      } else {
      document.getElementById('card-details-form').classList.add('d-none');
      document.getElementById('paypal-section').classList.remove('d-none');
    }
    
    bookingData.paymentMethod = method;
  }

  function processPayment() {
    const paymentBtn = document.getElementById('process-payment-btn');
    const originalText = paymentBtn.innerHTML;
    
    // Show processing state
    paymentBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
    paymentBtn.disabled = true;
    
    // Validate payment details if credit card is selected
    if (bookingData.paymentMethod === 'card') {
      const cardNumber = document.getElementById('card-number').value.replace(/\s/g, '');
      const expiryMonth = document.getElementById('expiry-month').value;
      const expiryYear = document.getElementById('expiry-year').value;
      const securityCode = document.getElementById('security-code').value;
      
      // Quick validation
      if (!cardNumber || cardNumber.length !== 16) {
        showToast('Please enter a valid card number');
        paymentBtn.innerHTML = originalText;
        paymentBtn.disabled = false;
        return;
      }
      
      if (!expiryMonth || !expiryYear) {
        showToast('Please select expiry date');
        paymentBtn.innerHTML = originalText;
        paymentBtn.disabled = false;
        return;
      }
      
      if (!securityCode || securityCode.length < 3) {
        showToast('Please enter security code');
        paymentBtn.innerHTML = originalText;
        paymentBtn.disabled = false;
        return;
      }
    }

    // Quick transition to confirmation
    const paymentContent = document.getElementById('content-4');
    const confirmContent = document.getElementById('content-5');

    // Instant fade out
    paymentContent.style.opacity = '0';
    paymentContent.style.transition = 'opacity 0.15s ease';

    setTimeout(() => {
      // Hide payment content
      paymentContent.classList.add('d-none');
      document.getElementById('step-4').classList.remove('active');
      
      // Show confirmation content
      confirmContent.classList.remove('d-none');
      confirmContent.style.opacity = '0';
      
      // Force reflow
      confirmContent.offsetHeight;
      
      // Fade in confirmation
      confirmContent.style.opacity = '1';
      confirmContent.style.transition = 'opacity 0.15s ease';
      document.getElementById('step-5').classList.add('active');
      
      // Update current step
      currentStep = 5;
      
      // Update confirmation details
      updateConfirmation();
      
      // Reset payment button
      paymentBtn.innerHTML = originalText;
      paymentBtn.disabled = false;
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      // Show success message
      const successToast = document.createElement('div');
      successToast.className = 'success-toast';
      successToast.innerHTML = `
        <div class="success-toast-content">
          <i class="fas fa-check-circle text-success me-2"></i>
          Payment successful! Confirming your booking...
        </div>
      `;
      document.body.appendChild(successToast);
      
      // Add success toast styles
      const style = document.createElement('style');
      style.textContent = `
        .success-toast {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1060;
          animation: slideIn 0.3s ease;
        }
        .success-toast-content {
          background: #fff;
          color: #198754;
          padding: 1rem 1.5rem;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          display: flex;
          align-items: center;
          font-weight: 500;
        }
        .dark-mode .success-toast-content {
          background: #343a40;
          color: #75b798;
        }
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      // Remove success toast after 3 seconds
      setTimeout(() => {
        successToast.style.opacity = '0';
        successToast.style.transition = 'opacity 0.3s ease';
        setTimeout(() => successToast.remove(), 300);
      }, 3000);
    }, 150);
  }

  // Add event listeners for summary updates
  document.getElementById('session-date').addEventListener('change', updateSessionSummary);
  document.getElementById('duration').addEventListener('change', updateSessionSummary);

  // Initialize time slots on page load
  window.addEventListener('load', () => {
    updateTimeSlots();
    
    // Set minimum date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('session-date').min = tomorrow.toISOString().split('T')[0];
  });

  // Add these new functions at the beginning of your script section
  function updateAuthButtons() {
    const authButtons = document.getElementById('authButtons');
    const user = JSON.parse(localStorage.getItem('user'));

    if (user) {
      // Get user details including profile picture
      const users = JSON.parse(localStorage.getItem(user.role === 'tutor' ? 'tutors' : 'students') || '[]');
      const userDetails = users.find(u => u.email === user.email);
      const profilePic = userDetails?.profilePicture || 'https://via.placeholder.com/150';

      // User is logged in
      authButtons.innerHTML = `
        <div class="d-flex align-items-center">
          <div class="profile-dropdown">
            <img src="${profilePic}" alt="Profile" class="profile-pic" id="profileDropdownBtn">
            <div class="profile-dropdown-menu" id="profileDropdownMenu">
              <div class="profile-header-item">
                <img src="${profilePic}" alt="Profile" class="profile-header-pic">
                <div class="profile-header-info">
                  <div class="name">${user.name}</div>
                  <div class="email">${user.email}</div>
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <a href="viewprofile.html" class="dropdown-item">
                <i class="fas fa-id-card"></i>
                View Profile
              </a>
              <a onclick="logout()" class="dropdown-item">
                <i class="fas fa-sign-out-alt"></i>
                Sign Out
              </a>
            </div>
          </div>
          <button class="btn btn-outline-secondary ms-2 dark-toggle" onclick="toggleDarkMode()">
            <i class="fas fa-moon"></i>
          </button>
        </div>
      `;

      // Add click event listener for profile dropdown
      const profileBtn = document.getElementById('profileDropdownBtn');
      const dropdownMenu = document.getElementById('profileDropdownMenu');
      
      profileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
        dropdownMenu.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.profile-dropdown')) {
          dropdownMenu.style.display = 'none';
          dropdownMenu.classList.remove('show');
        }
      });
    } else {
      // User is not logged in
      authButtons.innerHTML = `
        <a href="Login.html" class="btn btn-outline-primary me-2">Login</a>
        <a href="studentregister.html" class="btn btn-primary">Sign Up</a>
        <button class="btn btn-outline-secondary ms-2 dark-toggle" onclick="toggleDarkMode()">
          <i class="fas fa-moon"></i>
        </button>
      `;
    }
  }

  function logout() {
    localStorage.removeItem('user');
    window.location.href = 'index.html';
  }

  // Add this to your existing window.onload or document.addEventListener('DOMContentLoaded')
  document.addEventListener('DOMContentLoaded', () => {
    // Check dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
      toggleDarkMode();
    }
    
    // Update auth buttons
    updateAuthButtons();
  });
</script>
</body>
</html>